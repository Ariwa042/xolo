{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscription Payment - Emirex</title>
    <link rel="stylesheet" href="{% static 'css/deposit.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>Complete Your Payment</h1>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <label for="payment_type">Select Payment Method:</label>
                {{ form.payment_type }}
            </div>

            <div id="bank-details" style="display:block;">
                {% if payment_info %}
                <h2>Bank Account Details</h2>
                <p><strong>Bank Name:</strong> {{ payment_info.bank_name }}</p>
                <p><strong>Account Number:</strong> 
                    <span id="account-number">{{ payment_info.account_number }}</span>
                    <button type="button" onclick="copyToClipboard('account-number')"><i class="fa-solid fa-copy"></i>
                    </button>
                </p>
                {% endif %}
            </div>

            <div id="crypto-details" style="display: none;">
                <h2>Cryptocurrency Payment</h2>
                <label for="crypto_payment">Select Cryptocurrency:</label>
                <select id="crypto-payment-select" name="crypto_payment" class="form-control">
                    <option value="">Select Cryptocurrency</option>
                    {% for crypto in crypto_info %}
                    <option value="{{ crypto.id }}" data-wallet-address="{{ crypto.wallet_address }}" data-qr-code="{{ crypto.qr_code.url }}">
                        {{ crypto.name }} ({{ crypto.symbol }})
                    </option>
                    {% endfor %}
                </select>
                <div id="crypto-info" style="display: none; margin-top: 10px;">
                    <p><strong>Wallet Address:</strong> <span id="wallet-address"></span></p>
                    <img id="qr-code" src="" alt="QR Code" style="max-width: 200px; display: none;">
                </div>
            </div>

            <div class="form-group">
                <label for="subscription_plan">Select Subscription Plan:</label>
                {{ form.subscription_plan }}
            </div>

            <button type="submit" class="btn btn-primary">Submit Payment</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const paymentTypeInputs = document.querySelectorAll('input[name="payment_type"]');
            const bankDetails = document.getElementById('bank-details');
            const cryptoDetails = document.getElementById('crypto-details');
            const cryptoSelect = document.getElementById('crypto-payment-select');
            const cryptoInfo = document.getElementById('crypto-info');
            const walletAddress = document.getElementById('wallet-address');
            const qrCode = document.getElementById('qr-code');

            // Toggle payment sections based on payment type
            paymentTypeInputs.forEach(input => {
                input.addEventListener('change', function () {
                    if (this.value === 'BANK') {
                        bankDetails.style.display = 'block';
                        cryptoDetails.style.display = 'none';
                    } else if (this.value === 'CRYPTO') {
                        bankDetails.style.display = 'none';
                        cryptoDetails.style.display = 'block';
                    } else {
                        bankDetails.style.display = 'none';
                        cryptoDetails.style.display = 'none';
                    }
                });
            });

            // Update cryptocurrency details on selection
            cryptoSelect.addEventListener('change', function () {
                const selectedOption = this.options[this.selectedIndex];
                const wallet = selectedOption.getAttribute('data-wallet-address');
                const qrCodeUrl = selectedOption.getAttribute('data-qr-code');

                if (wallet && qrCodeUrl) {
                    walletAddress.textContent = wallet;
                    qrCode.src = qrCodeUrl;
                    qrCode.style.display = 'block';
                    cryptoInfo.style.display = 'block';
                } else {
                    walletAddress.textContent = '';
                    qrCode.src = '';
                    qrCode.style.display = 'none';
                    cryptoInfo.style.display = 'none';
                }
            });
        });

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard!');
            });
        }
    </script>
</body>
</html>